<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>wireframe</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <div class="main" style="position:relative; width: 600px; margin: 80px auto 0 auto;">
            <canvas id="wireframe" style="background-color:black; position:relative; border: 2px solid green;" width='600' height='400'></canvas>
            <p>Click on the canvas to give it focus. QWEASD controls pitch/yaw/roll of cube. HJKL moves cube left/right, up/down.</p>
        </div>
        <div id="controls">
            <label><input id="fov" type="number" value="90">FOV</label><br>
            <label><input id="camx" type="number" value="0">Cam Target X</label><br>
            <label><input id="camy" type="number" value="0">Cam Target Y</label><br>
            <label><input id="camz" type="number" value="0">Cam Target Z</label>
        </div>
        <div id="debug">
            
        </div>
        <script src="build/wireframe.js"></script>
        <script>
            (function () {
                var dbg = document.getElementById('debug');
                var Vector = wireframe.math.Vector;
                var Mesh = wireframe.math.Mesh;
                var Face = wireframe.math.Face;

                var Scene = wireframe.engine.Scene;
                var Camera = wireframe.engine.Camera;

                var cube = new Mesh('cube',
                    [
                        new Vector(-40, -40, -40),
                        new Vector(-40, -40,  40),
                        new Vector(-40,  40, -40),
                        new Vector(-40,  40,  40),
                        new Vector( 40, -40, -40),
                        new Vector( 40, -40,  40),
                        new Vector( 40,  40, -40),
                        new Vector( 40,  40,  40)
                    ],
                    [
                        new Face(3, 0, 1, 'red'), // Left
                        new Face(3, 2, 0, 'red'), // Left
                        new Face(5, 1, 0, 'red'), // Top
                        new Face(5, 0, 4, 'red'), // Top
                        new Face(2, 6, 4, 'red'), // Back
                        new Face(2, 4, 0, 'red'), // Back
                        new Face(7, 3, 1, 'red'), // Front
                        new Face(7, 1, 5, 'red'), // Front
                        new Face(6, 2, 3, 'red'), // Bottom
                        new Face(6, 3, 7, 'red'), // Bottom
                        new Face(6, 5, 4, 'red'), // Right
                        new Face(6, 7, 5, 'red')  // Right
                    ]);
                var icosjson = {
                    "name": "cube",
                    "vertices": [
                        [0,-69.03285,0],
                        [-49.9527, -30.872850000000003, -36.29235],
                        [19.07985, -30.872850000000003, -58.722750000000005],
                        [61.7448, -30.8726, 0],
                        [19.07985, -30.872850000000003, 58.722750000000005],
                        [-49.9527, -30.872850000000003, 36.29235],
                        [-19.07985, 30.872850000000003, -58.722750000000005],
                        [49.9527, 30.872850000000003, -36.29235],
                        [49.9527, 30.872850000000003, 36.29235],
                        [-19.07985, 30.872850000000003, 58.722750000000005],
                        [-61.7448, 30.8726, 0],
                        [0, 69.03285, 0],
                        [11.21475, -58.723099999999995, -34.5161],
                        [-29.36125, -58.723099999999995, -21.33195],
                        [-18.1466, -36.2932, -55.8484],
                        [-58.72265, -36.29305, 0],
                        [-29.36125, -58.723099999999995, 21.33195],
                        [36.29265, -58.72295, 0],
                        [47.5077, -36.2931, -34.516200000000005],
                        [11.21475, -58.723099999999995, 34.5161],
                        [47.5077, -36.2931, 34.516200000000005],
                        [-18.1466, -36.2932, 55.8484],
                        [-65.65425, 0, -21.33205],
                        [-65.65425, 0, 21.33205],
                        [0, 0, -69.03285],
                        [-40.57655, 0, -55.84875],
                        [65.65425, 0, -21.33205],
                        [40.57655, 0, -55.84875],
                        [40.57655, 0, 55.84875],
                        [65.65425, 0, 21.33205],
                        [-40.57655, 0, 55.84875],
                        [0, 0, 69.03285],
                        [-47.5077, 36.2931, -34.516200000000005],
                        [18.1466, 36.2932, -55.8484],
                        [58.72265, 36.29305, 0],
                        [18.1466, 36.2932, 55.8484],
                        [-47.5077, 36.2931, 34.516200000000005],
                        [-11.21475, 58.723099999999995, -34.5161],
                        [-36.29265, 58.72295, 0],
                        [29.36125, 58.723099999999995, -21.33195],
                        [29.36125, 58.723099999999995, 21.33195],
                        [-11.21475,58.723099999999995,34.5161]
                    ],
                    "faces": [
                        {"face": [12, 13, 0], "color": "red"},
                        {"face": [15, 13, 1], "color": "red"},
                        {"face": [17, 12, 0], "color": "red"},
                        {"face": [19, 17, 0], "color": "red"},
                        {"face": [16, 19, 0], "color": "red"},
                        {"face": [22, 15, 1], "color": "red"},
                        {"face": [24, 14, 2], "color": "red"},
                        {"face": [26, 18, 3], "color": "red"},
                        {"face": [28, 20, 4], "color": "red"},
                        {"face": [30, 21, 5], "color": "red"},
                        {"face": [25, 22, 1], "color": "red"},
                        {"face": [27, 24, 2], "color": "red"},
                        {"face": [29, 26, 3], "color": "red"},
                        {"face": [31, 28, 4], "color": "red"},
                        {"face": [23, 30, 5], "color": "red"},
                        {"face": [37, 32, 6], "color": "red"},
                        {"face": [39, 33, 7], "color": "red"},
                        {"face": [40, 34, 8], "color": "red"},
                        {"face": [41, 35, 9], "color": "red"},
                        {"face": [38, 36, 10], "color": "red"},
                        {"face": [2, 14, 12], "color": "red"},
                        {"face": [14, 13, 12], "color": "red"},
                        {"face": [14, 1, 13], "color": "red"},
                        {"face": [5, 16, 15], "color": "red"},
                        {"face": [16, 13, 15], "color": "red"},
                        {"face": [16, 0, 13], "color": "red"},
                        {"face": [3, 18, 17], "color": "red"},
                        {"face": [18, 12, 17], "color": "red"},
                        {"face": [18, 2, 12], "color": "red"},
                        {"face": [4, 20, 19], "color": "red"},
                        {"face": [20, 17, 19], "color": "red"},
                        {"face": [20, 3, 17], "color": "red"},
                        {"face": [5, 21, 16], "color": "red"},
                        {"face": [21, 19, 16], "color": "red"},
                        {"face": [21, 4, 19], "color": "red"},
                        {"face": [10, 23, 22], "color": "red"},
                        {"face": [23, 15, 22], "color": "red"},
                        {"face": [23, 5, 15], "color": "red"},
                        {"face": [6, 25, 24], "color": "red"},
                        {"face": [25, 14, 24], "color": "red"},
                        {"face": [25, 1, 14], "color": "red"},
                        {"face": [7, 27, 26], "color": "red"},
                        {"face": [27, 18, 26], "color": "red"},
                        {"face": [27, 2, 18], "color": "red"},
                        {"face": [8, 29, 28], "color": "red"},
                        {"face": [29, 20, 28], "color": "red"},
                        {"face": [29, 3, 20], "color": "red"},
                        {"face": [9, 31, 30], "color": "red"},
                        {"face": [31, 21, 30], "color": "red"},
                        {"face": [31, 4, 21], "color": "red"},
                        {"face": [6, 32, 25], "color": "red"},
                        {"face": [32, 22, 25], "color": "red"},
                        {"face": [32, 10, 22], "color": "red"},
                        {"face": [7, 33, 27], "color": "red"},
                        {"face": [33, 24, 27], "color": "red"},
                        {"face": [33, 6, 24], "color": "red"},
                        {"face": [8, 34, 29], "color": "red"},
                        {"face": [34, 26, 29], "color": "red"},
                        {"face": [34, 7, 26], "color": "red"},
                        {"face": [9, 35, 31], "color": "red"},
                        {"face": [35, 28, 31], "color": "red"},
                        {"face": [35, 8, 28], "color": "red"},
                        {"face": [10, 36, 23], "color": "red"},
                        {"face": [36, 30, 23], "color": "red"},
                        {"face": [36, 9, 30], "color": "red"},
                        {"face": [11, 38, 37], "color": "red"},
                        {"face": [38, 32, 37], "color": "red"},
                        {"face": [38, 10, 32], "color": "red"},
                        {"face": [11, 37, 39], "color": "red"},
                        {"face": [37, 33, 39], "color": "red"},
                        {"face": [37, 6, 33], "color": "red"},
                        {"face": [11, 39, 40], "color": "red"},
                        {"face": [39, 34, 40], "color": "red"},
                        {"face": [39, 7, 34], "color": "red"},
                        {"face": [11, 40, 41], "color": "red"},
                        {"face": [40, 35, 41], "color": "red"},
                        {"face": [40, 8, 35], "color": "red"},
                        {"face": [11, 41, 38], "color": "red"},
                        {"face": [41, 36, 38], "color": "red"},
                        {"face": [41, 9, 36], "color": "red"}
                     ]
                }

                var icos = Mesh.fromJSON(icosjson);
                var xaxis = new Mesh('xaxis',
                    [
                        new Vector(-80, 0, 0),
                        new Vector( 80, 0, 0)
                    ],
                    [
                        new Face(0, 0, 1, 'green')
                    ]
                    );
                var yaxis = new Mesh('yaxis',
                    [
                        new Vector(0, -80, 0),
                        new Vector(0,  80, 0)
                    ],
                    [
                        new Face(0, 0, 1, 'blue')
                    ]
                    );
                var zaxis = new Mesh('zaxis',
                    [
                        new Vector(0, 0, -80),
                        new Vector(0, 0,  80)
                    ],
                    [
                        new Face(0, 0, 1, 'yellow')
                    ]
                    );

                function rotateCube(){
                    if (scene.isKeyDown('a')) {
                        scene.meshes[0].rotation.yaw -= 0.03;
                    }
                    if (scene.isKeyDown('s')) {
                        scene.meshes[0].rotation.pitch -= 0.03;
                    }
                    if (scene.isKeyDown('f')) {
                        scene.meshes[0].rotation.yaw += 0.03;
                    }
                    if (scene.isKeyDown('d')) {
                        scene.meshes[0].rotation.pitch += 0.03;
                    }
                    if (scene.isKeyDown('w')) {
                        scene.meshes[0].rotation.roll += 0.03;
                    }
                    if (scene.isKeyDown('e')) {
                        scene.meshes[0].rotation.roll -= 0.03;
                    }
                }
                function moveCamera(){
                    if (scene.isKeyDown('h')) {
                        scene.camera.moveRight(1);
                    }
                    if (scene.isKeyDown('j')) {
                        scene.camera.moveUp(1);
                    }
                    if (scene.isKeyDown('k')) {
                        scene.camera.moveDown(1);
                    }
                    if (scene.isKeyDown('l')) {
                        scene.camera.moveLeft(1);
                    }
                    if (scene.isKeyDown('u')) {
                        scene.camera.zoomIn(1);
                    }
                    if (scene.isKeyDown('i')) {
                        scene.camera.zoomOut(1);
                    }
                    if (scene.isKeyDown('up_arrow')) {
                        scene.camera.moveForward(10);
                    }
                    if (scene.isKeyDown('down_arrow')) {
                        scene.camera.moveBackward(10);
                    }
                    if (scene.isKeyDown('left_arrow')) {
                        scene.camera.turnLeft(0.05);
                    }
                    if (scene.isKeyDown('right_arrow')) {
                        scene.camera.turnRight(0.05);
                    }
                    if (scene.isKeyDown('v')) {
                        scene.camera.moveLeft(10);
                    }
                    if (scene.isKeyDown('b')) {
                        scene.camera.moveRight(10);
                    }
                    if (scene.isKeyDown('p')) {
                        scene.camera.moveUp(10);
                    }
                    if (scene.isKeyDown('o')) {
                        scene.camera.moveDown(10);
                    }
                    // DEBUG
                    dbg.innerHTML = "CameraX: " + scene.camera.position.x + "<br>" +
                    "CameraY: " + scene.camera.position.y + "<br>" +
                    "CameraZ: " + scene.camera.position.z + "<br>";
                    scene._needs_update = true;
                }

                var scene = new Scene({canvas_id: 'wireframe', width:600, height:400});
                scene.addListener('keydown', rotateCube);
                scene.addListener('keydown', moveCamera);

                scene.camera.moveTo(0, 0, 400);
                scene.addMesh(cube);
                scene.addMesh(xaxis);
                scene.addMesh(yaxis);
                scene.addMesh(zaxis);
                scene.renderScene();

                //DEBUG
                var fov = document.getElementById('fov');
                fov.addEventListener('input', function(e){
                    scene.camera.fov = parseInt(this.value, 10);
                })
                var camx = document.getElementById('camx');
                camx.addEventListener('input', function(e){
                    scene.camera.target.x = parseInt(this.value, 10);
                    scene.camera.view_matrix = scene.camera.lookAt();
                })
                var camy = document.getElementById('camy');
                camy.addEventListener('input', function(e){
                    scene.camera.target.y = parseInt(this.value, 10);
                    scene.camera.view_matrix = scene.camera.lookAt();
                })
                var camz = document.getElementById('camz');
                camz.addEventListener('input', function(e){
                    scene.camera.target.z = parseInt(this.value, 10);
                    scene.camera.view_matrix = scene.camera.lookAt();
                })
            })();
        </script>
    </body>
</html>
