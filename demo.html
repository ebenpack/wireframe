<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>wireframe</title>
        <meta name="viewport" content="width=device-width, initial-scale=1">
    </head>
    <body>
        <div class="main" style="position:relative; width: 600px; margin: 80px auto 0 auto;">
            <canvas id="audiocanvas" style="background-color:black; position:relative; border: 2px solid green;" width='600' height='400'></canvas>
            <p>Click on the canvas to give it focus. QWEASD controls pitch/yaw/roll of cube. HJKL moves cube left/right, up/down.</p>
        </div>
        <div id="controls">
            <label><input id="fov" type="number" value="90">FOV</label><br>
            <label><input id="camx" type="number" value="0">Cam Target X</label><br>
            <label><input id="camy" type="number" value="0">Cam Target Y</label><br>
            <label><input id="camz" type="number" value="0">Cam Target Z</label>
        </div>
        <div id="debug">
            
        </div>
        <script src="build/wireframe.js"></script>
        <script>
            (function () {
                var dbg = document.getElementById('debug');
                var Vector = wireframe.math.Vector;
                var Mesh = wireframe.math.Mesh;
                var Face = wireframe.math.Face;

                var Scene = wireframe.engine.Scene;
                var Camera = wireframe.engine.Camera;

                var cube = new Mesh('cube',
                    [
                        new Vector(-40, -40, -40),
                        new Vector(-40, -40,  40),
                        new Vector(-40,  40, -40),
                        new Vector(-40,  40,  40),
                        new Vector( 40, -40, -40),
                        new Vector( 40, -40,  40),
                        new Vector( 40,  40, -40),
                        new Vector( 40,  40,  40)
                    ],
                    [
                        new Face(1, 3, 0, 'red'),
                        new Face(3, 2, 0, 'red'),
                        new Face(5, 1, 0, 'red'),
                        new Face(4, 5, 0, 'red'),
                        new Face(2, 6, 4, 'red'),
                        new Face(2, 4, 0, 'red'),
                        new Face(7, 3, 1, 'red'),
                        new Face(7, 1, 5, 'red'),
                        new Face(3, 7, 2, 'red'),
                        new Face(2, 7, 6, 'red'),
                        new Face(7, 5, 4, 'red'),
                        new Face(6, 7, 4, 'red')
                    ]);

                var xaxis = new Mesh('xaxis',
                    [
                        new Vector(-80, 0, 0),
                        new Vector( 80, 0, 0)
                    ],
                    [
                        new Face(0, 0, 1, 'green')
                    ]
                    );
                var yaxis = new Mesh('yaxis',
                    [
                        new Vector(0, -80, 0),
                        new Vector(0,  80, 0)
                    ],
                    [
                        new Face(0, 0, 1, 'blue')
                    ]
                    );
                var zaxis = new Mesh('zaxis',
                    [
                        new Vector(0, 0, -80),
                        new Vector(0, 0,  80)
                    ],
                    [
                        new Face(0, 0, 1, 'yellow')
                    ]
                    );

                function rotateCube(){
                    if (scene.isKeyDown('a')) {
                        scene.meshes[0].rotation.yaw -= 0.03;
                    }
                    if (scene.isKeyDown('s')) {
                        scene.meshes[0].rotation.pitch -= 0.03;
                    }
                    if (scene.isKeyDown('f')) {
                        scene.meshes[0].rotation.yaw += 0.03;
                    }
                    if (scene.isKeyDown('d')) {
                        scene.meshes[0].rotation.pitch += 0.03;
                    }
                    if (scene.isKeyDown('w')) {
                        scene.meshes[0].rotation.roll += 0.03;
                    }
                    if (scene.isKeyDown('e')) {
                        scene.meshes[0].rotation.roll -= 0.03;
                    }
                }
                function moveCamera(){
                    if (scene.isKeyDown('h')) {
                        scene.camera.moveRight(1);
                    }
                    if (scene.isKeyDown('j')) {
                        scene.camera.moveUp(1);
                    }
                    if (scene.isKeyDown('k')) {
                        scene.camera.moveDown(1);
                    }
                    if (scene.isKeyDown('l')) {
                        scene.camera.moveLeft(1);
                    }
                    if (scene.isKeyDown('u')) {
                        scene.camera.zoomIn(1);
                    }
                    if (scene.isKeyDown('i')) {
                        scene.camera.zoomOut(1);
                    }
                    // DEBUG
                    dbg.innerHTML = "CameraX: " + scene.camera.position.x + "<br>" +
                    "CameraY: " + scene.camera.position.y + "<br>" +
                    "CameraZ: " + scene.camera.position.z + "<br>";
                    scene._needs_update = true;
                }

                var scene = new Scene({canvas_id: 'audiocanvas', width:600, height:400});
                scene.addListener('keydown', rotateCube);
                scene.addListener('keydown', moveCamera);

                scene.camera.moveTo(0, 0, 400);
                scene.addMesh(cube);
                scene.addMesh(xaxis);
                scene.addMesh(yaxis);
                scene.addMesh(zaxis);
                scene.renderScene();

                //DEBUG
                var fov = document.getElementById('fov');
                fov.addEventListener('input', function(e){
                    scene.camera.fov = parseInt(this.value, 10);
                })
                var camx = document.getElementById('camx');
                camx.addEventListener('input', function(e){
                    scene.camera.target.x = parseInt(this.value, 10);
                    scene.camera.view_matrix = scene.camera.lookAt();
                })
                var camy = document.getElementById('camy');
                camy.addEventListener('input', function(e){
                    scene.camera.target.y = parseInt(this.value, 10);
                    scene.camera.view_matrix = scene.camera.lookAt();
                })
                var camz = document.getElementById('camz');
                camz.addEventListener('input', function(e){
                    scene.camera.target.z = parseInt(this.value, 10);
                    scene.camera.view_matrix = scene.camera.lookAt();
                })
            })();
        </script>
    </body>
</html>
